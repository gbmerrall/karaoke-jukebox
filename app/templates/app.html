{% extends "base.html" %}

{% block title %}Karaoke Jukebox{% endblock %}

{% block content %}
<!-- Queue Bar at Top -->
<div class="mb-6">
    <div class="flex items-center justify-between mb-2">
        <h2 class="text-2xl font-bold">Queue</h2>
        <span class="badge badge-primary badge-lg" id="queue-count">{{ queue|length }} songs</span>
    </div>

    <!-- Queue Container (updated via SSE) -->
    <div class="bg-base-100 rounded-lg shadow-lg p-4 min-h-[150px]">
        <div
            id="queue-content"
            hx-ext="sse"
            sse-connect="/queue/sse"
            sse-swap="queue-update"
        >
            <!-- Initial queue loaded from server -->
            {% include 'partials/queue.html' %}
        </div>
    </div>
</div>

<!-- Search Section -->
<div class="mb-6">
    <h2 class="text-2xl font-bold mb-4">Search for Songs</h2>

    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <!-- Search Form -->
            <form
                hx-post="/search"
                hx-target="#search-results"
                hx-swap="innerHTML"
            >
                <div class="form-control">
                    <div class="flex gap-2 w-full">
                        <input
                            type="text"
                            name="query"
                            placeholder="Search for a song or artist..."
                            class="input input-bordered flex-1"
                            required
                        />
                        <button type="submit" class="btn btn-primary">
                            Search
                        </button>
                    </div>
                    <label class="label">
                        <span class="label-text-alt">ðŸ’¡ Tip: We'll automatically search for karaoke versions!</span>
                    </label>
                </div>
            </form>

            <!-- Search Results Container -->
            <div id="search-results" class="mt-4">
                <!-- Results will be loaded here via HTMX -->
            </div>
        </div>
    </div>
</div>

<!-- Modal Container (for queue confirmations, errors, etc.) -->
<div id="modal-container"></div>

{% endblock %}

{% block extra_scripts %}
<script>
    // Update queue count when queue updates
    document.body.addEventListener('htmx:afterSwap', function(event) {
        if (event.detail.target.id === 'queue-content') {
            // Count the number of queue items
            const count = event.detail.target.querySelectorAll('.queue-item').length;
            const badge = document.getElementById('queue-count');
            if (badge) {
                badge.textContent = count + (count === 1 ? ' song' : ' songs');
            }
        }
    });
</script>
{% endblock %}
